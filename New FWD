#!/bin/bash
sudo firewall-cmd --set-default-zone=block  

# Remove SSH access  
sudo firewall-cmd --remove-port=22/tcp  

# Add source rules  
sudo firewall-cmd --zone=block --add-rich-rule='rule family="ipv4" source address="172.20.242.200" port protocol="tcp" port="389" accept'  
sudo firewall-cmd --zone=block --add-rich-rule='rule family="ipv4" source address="172.20.241.20" port protocol="tcp" port="9997" accept'  

# Add mail-related services  
sudo firewall-cmd --zone=block --add-service=smtp      # Postfix  
sudo firewall-cmd --zone=block --add-service=pop3      # Dovecot  
sudo firewall-cmd --zone=block --add-service=pop3s     # Encrypted POP3  
sudo firewall-cmd --zone=block --add-service=imap      # IMAP  
sudo firewall-cmd --zone=block --add-service=imaps     # Encrypted IMAP  
sudo firewall-cmd --zone=block --add-service=dns       # DNS for mail resolution  

# Add specific mail-related ports  
sudo firewall-cmd --zone=block --add-port=25/tcp       # SMTP  
sudo firewall-cmd --zone=block --add-port=110/tcp      # POP3  
sudo firewall-cmd --zone=block --add-port=995/tcp      # POP3S  
sudo firewall-cmd --zone=block --add-port=143/tcp      # IMAP  
sudo firewall-cmd --zone=block --add-port=993/tcp      # IMAPS  
sudo firewall-cmd --zone=block --add-port=53/tcp       # DNS over TCP  
sudo firewall-cmd --zone=block --add-port=53/udp       # DNS over UDP  

# Enable logging for denied packets  
sudo firewall-cmd --set-log-denied=all  

# Monitor the firewall logs  
sudo tail -f ../../var/log/firewalld
